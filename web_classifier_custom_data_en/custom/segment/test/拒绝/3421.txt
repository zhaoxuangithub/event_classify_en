However , the Thebans refused to meet the Spartan army in battle , instead building a trench and stockade outside Thebes , which they occupied , preventing the Spartans advancing on the city .