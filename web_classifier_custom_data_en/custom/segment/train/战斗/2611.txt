During the rest of the campaign , he served as a duty officer in the headquarters of the main Russian army and fought at Maloyaroslavets .